"use strict";angular.module("adminApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,b.defaults.withCredentials=!0,window.errors=webErrors.errors,a.when("/",{templateUrl:"views/dashboard/main.html",controller:"MainCtrl"}).when("/admin/login",{templateUrl:"views/admin/login.html",controller:"AdminCtrl"}).when("/admin/password",{templateUrl:"views/admin/password.html",controller:"AdminCtrl"}).when("/home",{templateUrl:"views/admin/home.html",controller:"HomeCtrl"}).when("/dashboard",{templateUrl:"views/admin/home.html",controller:"HomeCtrl"}).when("/dashboard/merchandise",{templateUrl:"views/dashboard/merchandise.html",controller:"MerchandiseCtrl"}).when("/dashboard/merchandise/list/:page",{templateUrl:"views/dashboard/merchandise/list.html",controller:"MerchandiseCtrl"}).when("/dashboard/category/:id/list/:page",{templateUrl:"views/dashboard/category/list.html",controller:"CategoryCtrl"}).when("/dashboard/image/list/:page",{templateUrl:"views/dashboard/image/list.html",controller:"ImageCtrl"}).when("/dashboard/area/:id/list/:page",{templateUrl:"views/dashboard/area/list.html",controller:"AreaCtrl"}).when("/dashboard/user/list/:page",{templateUrl:"views/dashboard/user/list.html",controller:"UserCtrl"}).when("/dashboard/barcode/list/:page",{templateUrl:"views/dashboard/barcode/list.html",controller:"BarcodeCtrl"}).when("/dashboard/merchant/list/:page",{templateUrl:"views/dashboard/merchant/list.html",controller:"MerchantCtrl"})}]),angular.module("adminApp").controller("MainCtrl",["$scope","$location","api",function(a,b,c){c.auth(function(a){a?b.path("/admin/login"):b.path("/home")})}]),angular.module("adminApp").controller("AdminCtrl",["$scope","$location","api",function(a,b,c){a.login=function(a,d){c.send("admin/login",{username:a,password:d},function(a){"code"in a&&!a.code&&b.path("/home")})},a.modify=function(a,b,d){return b!==d?(alert("新密码不一致！"),!1):(c.send("admin/update",{old:a,"new":b,confirm:d},function(a){"code"in a&&!a.code&&alert("密码更新成功!")}),!1)}}]),angular.module("adminApp").service("api",["$http","$location","url","modal",function(a,b,c,d){function e(a){return c+g+"/"+a}function f(c,f,g,i){var j;j=f?f instanceof FormData?a.post(e(c),f,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}):a.post(e(c),f):a.post(e(c)),g=g||h,j.success(function(a){if(console.log(a),"code"in a)if("code"in a&&!a.code)i(a);else switch(a.code){case errors.ADMIN_NOT_LOGIN.code:b.path(g);break;case errors.DATABASE_ERROR:d.alert(a.message);break;default:d.alert(a.message)}else alert("请求出错，请确认网络连接正常。")}).error(function(){"admin/profile"===c&&b.path(g)})}var g="admin",h="/admin/login";return{send:function(a,b,c){f(a,b,h,c)},auth:function(){f("admin/profile",null,null,function(a){a&&"code"in a&&(a.code?b.path("/home"):b.path(h))})},logout:function(a){f("admin/logout",null,h,function(b){a(b)})},list:function(a,b,c){f(a,b,h,function(a){c(a)})},upload:function(c,f,g){a.post(e(c),f,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){if("code"in a)if("code"in a&&!a.code)g(a);else switch(a.code){case errors.ADMIN_NOT_LOGIN.code:b.path(h);break;default:d.alert(a.message)}else;}).error(function(){b.path(h)})}}}]),angular.module("adminApp").controller("HomeCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("adminApp").controller("NavCtrl",["$scope","$location","api",function(a,b,c){c.send("admin/profile",null,function(b){b&&"code"in b&&(b.code||(a.admin=b.data))}),a.exit=function(){c.logout(function(a){a.code===errors.SUCCESS.code&&b.path("/admin/login")})}}]),angular.module("adminApp").controller("MerchandiseCtrl",["$scope","$route","api","modal",function(a,b,c,d){function e(b){b.code||(a.merchandises=b.data[0].merchandises,a.page=b.data[0].page,a.total=b.data[0].total)}var f=parseInt(b.current.params.page);a.base="dashboard/merchandise",a.module="merchandise",a.openModify=function(b){a.merchandise=b},a.modify=function(){a.id=a.merchandise.id;var b=new FormData($("form.modify")[0]);c.upload("merchandise/update",b,function(a){if(a)switch(a.code){case 0:d.alert("修改成功！"),$("#modify").modal("hide"),$(".img-thumbnail").remove(),$("form.modify")[0].reset(),c.list("merchandise/list",{page:f},e)}})},a.removeImage=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("merchandise/removeimg",{id:a},function(b){b.code||($(".merchandise-edit-image-"+a).remove(),c.list("merchandise/list",{page:f},e))})},c.list("merchandise/list",{page:f},e),a.add=function(){var a=new FormData($("form.add")[0]);c.upload("merchandise/add",a,function(a){if(a)switch(a.code){case 0:d.alert("添加成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),$("form.add")[0].reset(),c.list("merchandise/list",{page:f},e)}})},a.remove=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("merchandise/remove",{id:a.id},function(a){a.code||c.list("merchandise/list",{page:f},e)})},a.online=function(a){c.send("merchandise/online",{id:a.id},function(a){a.code||c.list("merchandise/list",{page:f},e)})},a.offline=function(a){c.send("merchandise/offline",{id:a.id},function(a){a.code||c.list("merchandise/list",{page:f},e)})}}]),angular.module("adminApp").controller("CategoryCtrl",["$scope","$route","$location","api",function(a,b,c,d){function e(b){b.code||(a.subCategories=b.data[0].categories,a.page=b.data[0].page,a.total=b.data[0].total)}function f(a){for(var b=[],c=0;c<a.length;c++)b.push(a[a.length-1-c]);return b}function g(b){d.send("category/parents",{id:b},function(b){b.code||(a.parents=f(b.data))})}var h="category";a.$on("$includeContentLoaded",function(){a.module=h});var i=parseInt(b.current.params.id),j=parseInt(b.current.params.page);a.base="dashboard/"+h+"/"+i,a.id=i,d.list("category/list",{id:i,page:j},e),g(i),a.add=function(){var a=new FormData($("form.add")[0]);d.upload("category/add",a,function(a){if(a)switch(a.code){case 0:alert("添加成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),$("form.add")[0].reset(),d.list("category/list",{id:i,page:j},e)}})},a.goCategory=function(a){var b="dashboard/category/"+a.id+"/list/1";c.path(b)},a.openModify=function(b){a.subCategory=b},a.modify=function(){a.id=a.subCategory.id;var b=new FormData($("form.modify")[0]);d.upload("category/update",b,function(a){if(a)switch(a.code){case 0:alert("修改成功！"),$("#modify").modal("hide"),$(".img-thumbnail").remove(),$("form.modify")[0].reset(),d.list("category/list",{id:i,page:j},e)}})},a.removeImage=function(a){confirm("确定要删除吗?操作不可恢复!")&&d.send("category/removeimg",{id:a},function(b){b.code||($(".category-edit-image-"+a).remove(),d.list("category/list",{id:a,page:j},e))})},a.remove=function(a){confirm("确定要删除吗?操作不可恢复!")&&d.send("category/remove",{id:a.id},function(a){a.code||d.list("category/list",{id:i,page:j},e)})}}]);var url="http://api.t1bao.com/";window.localStorage&&window.localStorage.getItem("url")&&(url=window.localStorage.getItem("url")),angular.module("adminApp").constant("url",url),angular.module("adminApp").controller("ImageCtrl",["$scope","$route","api",function(a,b,c){a.$on("$includeContentLoaded",function(){a.module="image"});var d=parseInt(b.current.params.page);1>d&&(d=1),a.page=d,a.base="dashboard/image",c.list("image/list",{page:d},function(b){b.code||(a.images=b.data[0].images,a.total=b.data[0].total)}),a.remove=function(a){window.confirm("确定要删除吗？操作不可恢复！")&&c.send("image/remove",{id:a.id},function(b){if(b)switch(b.code){case 0:alert("删除成功！"),$(".image-operator-"+a.id).remove()}})},a.upload=function(){console.log("uploading");var b=new FormData($("form.image")[0]);return c.upload("image/upload",b,function(b){if(b)switch(b.code){case 0:alert("上传成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),c.list("image/list",{page:d},function(b){b.code||(a.images=b.data[0].images,a.total=b.data[0].total)})}}),!1}}]),angular.module("adminApp").controller("AreaCtrl",["$scope","$route","$location","api",function(a,b,c,d){function e(b){b.code||(a.areas=b.data[0].areas,a.page=b.data[0].page,a.total=b.data[0].total)}function f(a){for(var b=[],c=0;c<a.length;c++)b.push(a[a.length-1-c]);return b}function g(b){d.send("area/parents",{id:b},function(b){b.code||(a.parents=f(b.data))})}var h="area";a.$on("$includeContentLoaded",function(){a.module=h});var i=parseInt(b.current.params.id),j=parseInt(b.current.params.page);a.base="dashboard/"+h+"/"+i,a.id=i,d.list("area/list",{id:i,page:j},e),g(i),a.add=function(){var a=new FormData($("form.add")[0]);d.upload("area/add",a,function(a){if(a)switch(a.code){case 0:alert("添加成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),$("form.add")[0].reset(),d.list("area/list",{id:i,page:j},e)}})},a.goArea=function(a){var b="dashboard/area/"+a.id+"/list/1";c.path(b)},a.openModify=function(b){if(a.area=b,b&&b.type){var c="option[value="+b.type+"]";$(c).attr("selected","selected")}},a.openAdd=function(){var a="option[value=0]";$(a).attr("selected","selected")},a.modify=function(){a.id=a.area.id;var b=new FormData($("form.modify")[0]);d.upload("area/update",b,function(a){if(a)switch(a.code){case 0:alert("修改成功！"),$("#modify").modal("hide"),$(".img-thumbnail").remove(),$("form.modify")[0].reset(),d.list("area/list",{id:i,page:j},e)}})},a.removeImage=function(a){confirm("确定要删除吗?操作不可恢复!")&&d.send("area/removeimg",{id:a},function(b){b.code||($(".area-edit-image-"+a).remove(),d.list("area/list",{id:a,page:j},e))})},a.remove=function(a){confirm("确定要删除吗?操作不可恢复!")&&d.send("area/remove",{id:a.id},function(a){a.code||d.list("area/list",{id:i,page:j},e)})}}]),angular.module("adminApp").filter("area",function(){return function(a){var b={country:"国家",area:"地区",province:"省",city:"市",zone:"区",county:"县",village:"乡",town:"镇"};return a in b?b[a]:""}}),angular.module("adminApp").controller("UserCtrl",["$scope","$route","api","modal",function(a,b,c,d){function e(b){b.code||(a.users=b.data[0].users,a.total=b.data[0].total)}a.$on("$includeContentLoaded",function(){a.module="user"});var f=parseInt(b.current.params.page);1>f&&(f=1),a.page=f,a.base="dashboard/user",c.list("user/list",{page:f},e),a.openModify=function(b){a.user=b},a.resetPassowrd=function(a){var b=prompt("请输入新的密码！");b&&c.send("user/password/edit",{id:a.id,password:b},function(a){a.code||d.alert("密码更新成功！")})},a.modify=function(){a.id=a.user.id;var b=new FormData($("form.modify")[0]);c.upload("user/update",b,function(a){if(a)switch(a.code){case 0:$("form.modify")[0].reset(),$("#modify").modal("hide"),d.alert("修改成功！"),$("form")[0].reset(),c.list("user/list",{page:f},e)}})},a.remove=function(a){window.confirm("确定要删除吗？操作不可恢复！")&&c.send("user/remove",{id:a.id},function(b){if(b)switch(b.code){case 0:d.alert("删除成功！"),$(".user-operator-"+a.id).remove()}})},a.add=function(){console.log("adding");var a=new FormData($("form.user")[0]);return c.send("user/add",a,function(a){if(a)switch(a.code){case 0:d.alert("添加成功！"),$("#add").modal("hide"),$("form").each(function(){this.reset()}),c.list("user/list",{page:f},e)}}),!1}}]),angular.module("adminApp").service("modal",function(){return{alert:function(a){$("#alert").modal("show"),$(".modal-body",$("#alert")).html(a)}}}),angular.module("adminApp").controller("BarcodeCtrl",["$scope","$route","api","modal",function(a,b,c,d){function e(b){b.code||(a.barcodes=b.data.results,a.page=b.data.page,a.total=b.data.total)}a.module="barcode";var f=parseInt(b.current.params.page);a.base="dashboard/barcode";var g="barcode/list";a.openModify=function(b){a.barcode=b},a.modify=function(){a.id=a.barcode.id;var b=new FormData($("form.modify")[0]);c.upload("barcode/update",b,function(a){if(a)switch(a.code){case 0:d.alert("修改成功！"),$("#modify").modal("hide"),$(".img-thumbnail").remove(),$("form.modify")[0].reset(),c.list(g,{page:f},e)}})},a.removeImage=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("barcode/removeimg",{id:a},function(b){b.code||($(".barcode-edit-image-"+a).remove(),c.list(g,{page:f},e))})},c.list(g,{page:f},e),a.add=function(){var a=new FormData($("form.add")[0]);c.upload("barcode/add",a,function(a){if(a)switch(a.code){case 0:d.alert("添加成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),$("form.add")[0].reset(),c.list(g,{page:f},e)}})},a.remove=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("barcode/remove",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})},a.online=function(a){c.send("barcode/online",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})},a.offline=function(a){c.send("barcode/offline",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})}}]),angular.module("adminApp").controller("MerchantCtrl",["$scope","$route","api","modal",function(a,b,c,d){function e(b){b.code||(a.merchants=b.data.results,a.page=b.data.page,a.total=b.data.total)}var f=parseInt(b.current.params.page);a.base="dashboard/merchant",a.module="merchant";var g="store/list";a.openModify=function(b){a.merchant=b},a.modify=function(){a.id=a.merchant.id;var b=new FormData($("form.modify")[0]);c.upload("store/update",b,function(a){if(a)switch(a.code){case 0:d.alert("修改成功！"),$("#modify").modal("hide"),$(".img-thumbnail").remove(),$("form.modify")[0].reset(),c.list(g,{page:f},e)}})},a.removeImage=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("store/removeimg",{id:a},function(b){b.code||($(".merchant-edit-image-"+a).remove(),c.list(g,{page:f},e))})},c.list(g,{page:f},e),a.add=function(){var a=new FormData($("form.add")[0]);c.upload("store/add",a,function(a){if(a)switch(a.code){case 0:d.alert("添加成功！"),$("#add").modal("hide"),$(".img-thumbnail").remove(),$("form.add")[0].reset(),c.list(g,{page:f},e)}})},a.remove=function(a){confirm("确定要删除吗?操作不可恢复!")&&c.send("store/remove",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})},a.online=function(a){c.send("store/online",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})},a.offline=function(a){c.send("store/offline",{id:a.id},function(a){a.code||c.list(g,{page:f},e)})}}]),angular.module("adminApp").filter("date",function(){return function(a){var b=new Date(a);return moment(b).format("YYYY-MM-DD hh:mm:ss")}});